{"version":3,"sources":["useTooltip.js"],"sourcesContent":["import * as React from 'react';\nimport { mergeArrowOffset, resolvePositioningShorthand, usePositioning } from '@fluentui/react-positioning';\nimport { useTooltipVisibility_unstable as useTooltipVisibility, useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { applyTriggerPropsToChildren, useControllableState, useId, useIsomorphicLayoutEffect, useIsSSR, useMergedRefs, useTimeout, getTriggerChild, mergeCallbacks, useEventCallback, slot } from '@fluentui/react-utilities';\nimport { arrowHeight, tooltipBorderRadius } from './private/constants';\nimport { Escape } from '@fluentui/keyboard-keys';\n/**\n * Create the state required to render Tooltip.\n *\n * The returned state can be modified with hooks such as useTooltipStyles_unstable,\n * before being passed to renderTooltip_unstable.\n *\n * @param props - props from this instance of Tooltip\n */ export const useTooltip_unstable = (props)=>{\n    var _child_props, _child_props1, _child_props2, _child_props3;\n    const context = useTooltipVisibility();\n    const isServerSideRender = useIsSSR();\n    const { targetDocument } = useFluent();\n    const [setDelayTimeout, clearDelayTimeout] = useTimeout();\n    const { appearance = 'normal', children, content, withArrow = false, positioning = 'above', onVisibleChange, relationship, showDelay = 250, hideDelay = 250, mountNode } = props;\n    const [visible, setVisibleInternal] = useControllableState({\n        state: props.visible,\n        initialState: false\n    });\n    const setVisible = React.useCallback((ev, data)=>{\n        clearDelayTimeout();\n        setVisibleInternal((oldVisible)=>{\n            if (data.visible !== oldVisible) {\n                onVisibleChange === null || onVisibleChange === void 0 ? void 0 : onVisibleChange(ev, data);\n            }\n            return data.visible;\n        });\n    }, [\n        clearDelayTimeout,\n        setVisibleInternal,\n        onVisibleChange\n    ]);\n    const state = {\n        withArrow,\n        positioning,\n        showDelay,\n        hideDelay,\n        relationship,\n        visible,\n        shouldRenderTooltip: visible,\n        appearance,\n        mountNode,\n        // Slots\n        components: {\n            content: 'div'\n        },\n        content: slot.always(content, {\n            defaultProps: {\n                role: 'tooltip'\n            },\n            elementType: 'div'\n        })\n    };\n    state.content.id = useId('tooltip-', state.content.id);\n    const positioningOptions = {\n        enabled: state.visible,\n        arrowPadding: 2 * tooltipBorderRadius,\n        position: 'above',\n        align: 'center',\n        offset: 4,\n        ...resolvePositioningShorthand(state.positioning)\n    };\n    if (state.withArrow) {\n        positioningOptions.offset = mergeArrowOffset(positioningOptions.offset, arrowHeight);\n    }\n    const { targetRef, containerRef, arrowRef } = usePositioning(positioningOptions);\n    state.content.ref = useMergedRefs(state.content.ref, containerRef);\n    state.arrowRef = arrowRef;\n    // When this tooltip is visible, hide any other tooltips, and register it\n    // as the visibleTooltip with the TooltipContext.\n    // Also add a listener on document to hide the tooltip if Escape is pressed\n    useIsomorphicLayoutEffect(()=>{\n        if (visible) {\n            var _context_visibleTooltip;\n            const thisTooltip = {\n                hide: (ev)=>setVisible(undefined, {\n                        visible: false,\n                        documentKeyboardEvent: ev\n                    })\n            };\n            (_context_visibleTooltip = context.visibleTooltip) === null || _context_visibleTooltip === void 0 ? void 0 : _context_visibleTooltip.hide();\n            context.visibleTooltip = thisTooltip;\n            const onDocumentKeyDown = (ev)=>{\n                if (ev.key === Escape && !ev.defaultPrevented) {\n                    thisTooltip.hide(ev);\n                    // stop propagation to avoid conflicting with other elements that listen for `Escape`\n                    // e,g: Dialog, Popover, Menu and Tooltip\n                    ev.preventDefault();\n                }\n            };\n            targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.addEventListener('keydown', onDocumentKeyDown, {\n                // As this event is added at targeted document,\n                // we need to capture the event to be sure keydown handling from tooltip happens first\n                capture: true\n            });\n            return ()=>{\n                if (context.visibleTooltip === thisTooltip) {\n                    context.visibleTooltip = undefined;\n                }\n                targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.removeEventListener('keydown', onDocumentKeyDown, {\n                    capture: true\n                });\n            };\n        }\n    }, [\n        context,\n        targetDocument,\n        visible,\n        setVisible\n    ]);\n    // The focused element gets a blur event when the document loses focus\n    // (e.g. switching tabs in the browser), but we don't want to show the\n    // tooltip again when the document gets focus back. Handle this case by\n    // checking if the blurred element is still the document's activeElement.\n    // See https://github.com/microsoft/fluentui/issues/13541\n    const ignoreNextFocusEventRef = React.useRef(false);\n    // Listener for onPointerEnter and onFocus on the trigger element\n    const onEnterTrigger = React.useCallback((ev)=>{\n        if (ev.type === 'focus' && ignoreNextFocusEventRef.current) {\n            ignoreNextFocusEventRef.current = false;\n            return;\n        }\n        // Show immediately if another tooltip is already visible\n        const delay = context.visibleTooltip ? 0 : state.showDelay;\n        setDelayTimeout(()=>{\n            setVisible(ev, {\n                visible: true\n            });\n        }, delay);\n        ev.persist(); // Persist the event since the setVisible call will happen asynchronously\n    }, [\n        setDelayTimeout,\n        setVisible,\n        state.showDelay,\n        context\n    ]);\n    // Listener for onPointerLeave and onBlur on the trigger element\n    const onLeaveTrigger = React.useCallback((ev)=>{\n        let delay = state.hideDelay;\n        if (ev.type === 'blur') {\n            // Hide immediately when losing focus\n            delay = 0;\n            ignoreNextFocusEventRef.current = (targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.activeElement) === ev.target;\n        }\n        setDelayTimeout(()=>{\n            setVisible(ev, {\n                visible: false\n            });\n        }, delay);\n        ev.persist(); // Persist the event since the setVisible call will happen asynchronously\n    }, [\n        setDelayTimeout,\n        setVisible,\n        state.hideDelay,\n        targetDocument\n    ]);\n    // Cancel the hide timer when the mouse or focus enters the tooltip, and restart it when the mouse or focus leaves.\n    // This keeps the tooltip visible when the mouse is moved over it, or it has focus within.\n    state.content.onPointerEnter = mergeCallbacks(state.content.onPointerEnter, clearDelayTimeout);\n    state.content.onPointerLeave = mergeCallbacks(state.content.onPointerLeave, onLeaveTrigger);\n    state.content.onFocus = mergeCallbacks(state.content.onFocus, clearDelayTimeout);\n    state.content.onBlur = mergeCallbacks(state.content.onBlur, onLeaveTrigger);\n    const child = getTriggerChild(children);\n    const triggerAriaProps = {};\n    if (relationship === 'label') {\n        // aria-label only works if the content is a string. Otherwise, need to use aria-labelledby.\n        if (typeof state.content.children === 'string') {\n            triggerAriaProps['aria-label'] = state.content.children;\n        } else {\n            triggerAriaProps['aria-labelledby'] = state.content.id;\n            // Always render the tooltip even if hidden, so that aria-labelledby refers to a valid element\n            state.shouldRenderTooltip = true;\n        }\n    } else if (relationship === 'description') {\n        triggerAriaProps['aria-describedby'] = state.content.id;\n        // Always render the tooltip even if hidden, so that aria-describedby refers to a valid element\n        state.shouldRenderTooltip = true;\n    }\n    // Don't render the Tooltip in SSR to avoid hydration errors\n    if (isServerSideRender) {\n        state.shouldRenderTooltip = false;\n    }\n    const childTargetRef = useMergedRefs(child === null || child === void 0 ? void 0 : child.ref, targetRef);\n    // Apply the trigger props to the child, either by calling the render function, or cloning with the new props\n    state.children = applyTriggerPropsToChildren(children, {\n        ...triggerAriaProps,\n        ...child === null || child === void 0 ? void 0 : child.props,\n        // If the target prop is not provided, attach targetRef to the trigger element's ref prop\n        ref: positioningOptions.target === undefined ? childTargetRef : child === null || child === void 0 ? void 0 : child.ref,\n        onPointerEnter: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : (_child_props = child.props) === null || _child_props === void 0 ? void 0 : _child_props.onPointerEnter, onEnterTrigger)),\n        onPointerLeave: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : (_child_props1 = child.props) === null || _child_props1 === void 0 ? void 0 : _child_props1.onPointerLeave, onLeaveTrigger)),\n        onFocus: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : (_child_props2 = child.props) === null || _child_props2 === void 0 ? void 0 : _child_props2.onFocus, onEnterTrigger)),\n        onBlur: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : (_child_props3 = child.props) === null || _child_props3 === void 0 ? void 0 : _child_props3.onBlur, onLeaveTrigger))\n    });\n    return state;\n};\n"],"names":["useTooltip_unstable","props","_child_props","_child_props1","_child_props2","_child_props3","context","useTooltipVisibility","isServerSideRender","useIsSSR","targetDocument","useFluent","setDelayTimeout","clearDelayTimeout","useTimeout","appearance","children","content","withArrow","positioning","onVisibleChange","relationship","showDelay","hideDelay","mountNode","visible","setVisibleInternal","useControllableState","state","initialState","setVisible","React","useCallback","ev","data","oldVisible","shouldRenderTooltip","components","slot","always","defaultProps","role","elementType","id","useId","positioningOptions","enabled","arrowPadding","tooltipBorderRadius","position","align","offset","resolvePositioningShorthand","mergeArrowOffset","arrowHeight","targetRef","containerRef","arrowRef","usePositioning","ref","useMergedRefs","useIsomorphicLayoutEffect","_context_visibleTooltip","thisTooltip","hide","undefined","documentKeyboardEvent","visibleTooltip","onDocumentKeyDown","key","Escape","defaultPrevented","preventDefault","addEventListener","capture","removeEventListener","ignoreNextFocusEventRef","useRef","onEnterTrigger","type","current","delay","persist","onLeaveTrigger","activeElement","target","onPointerEnter","mergeCallbacks","onPointerLeave","onFocus","onBlur","child","getTriggerChild","triggerAriaProps","childTargetRef","applyTriggerPropsToChildren","useEventCallback"],"mappings":"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"}